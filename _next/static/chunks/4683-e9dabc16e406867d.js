"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4683],{49127:function(e,t,r){r.d(t,{H:function(){return s},a:function(){return d}});var i=r(57437),a=r(2265),n=r(6649);let o=(0,a.createContext)(void 0);function s(e){var t;let{children:r}=e,{login:s,logout:d,authenticated:u,user:l}=(0,n.s)(),[c,f]=(0,a.useState)({isLoading:!1,isAuthenticated:!1,user:null,showLoginModal:!1,showUserForm:!1});(0,a.useEffect)(()=>{let e=!0;return(async()=>{var t,r;if(!e||!(null==l?void 0:null===(t=l.wallet)||void 0===t?void 0:t.address))return;let i=l.wallet.address;if(u&&i!==(null===(r=c.user)||void 0===r?void 0:r.walletAddress)){f(e=>({...e,isLoading:!0}));try{let t=await fetch("/api/users?walletId=".concat(i));if(!e)return;if(t.ok){let{user:e}=await t.json();f(t=>({...t,isAuthenticated:!0,user:{...e,walletAddress:i},showUserForm:!1,showLoginModal:!1,isLoading:!1}))}else 404===t.status&&f(e=>({...e,isAuthenticated:!1,user:{walletAddress:i},showUserForm:!0,showLoginModal:!0,isLoading:!1}))}catch(t){if(!e)return;console.error("Error checking user:",t),f(e=>({...e,isLoading:!1}))}}else u||f(e=>({...e,isAuthenticated:!1,user:null,isLoading:!1}))})(),()=>{e=!1}},[u,null==l?void 0:null===(t=l.wallet)||void 0===t?void 0:t.address]);let m=async()=>{f(e=>({...e,showLoginModal:!0}));try{await s()}catch(e){console.error("Login error:",e),f(e=>({...e,showLoginModal:!1}))}},p=async()=>{f(e=>({...e,isLoading:!0}));try{await d(),f(e=>({...e,isAuthenticated:!1,user:null,showLoginModal:!1,showUserForm:!1}))}catch(e){console.error("Logout error:",e)}finally{f(e=>({...e,isLoading:!1}))}},y=async e=>{var t;if(null===(t=c.user)||void 0===t?void 0:t.walletAddress){f(e=>({...e,isLoading:!0}));try{let t=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,walletId:c.user.walletAddress})});if(!t.ok)throw Error("Failed to update user");let{user:r}=await t.json();f(e=>{var t;return{...e,isAuthenticated:!0,user:{...r,walletAddress:null===(t=c.user)||void 0===t?void 0:t.walletAddress},showUserForm:!1,showLoginModal:!1}})}catch(e){console.error("Update user error:",e)}finally{f(e=>({...e,isLoading:!1}))}}};return(0,i.jsx)(o.Provider,{value:{...c,login:m,logout:p,updateUser:y,setShowLoginModal:e=>f(t=>({...t,showLoginModal:e}))},children:r})}let d=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},37418:function(e,t,r){r.d(t,{$$:function(){return p},If:function(){return f},JG:function(){return _},L0:function(){return m},Ue:function(){return y},ag:function(){return L},r4:function(){return l},uE:function(){return w},ym:function(){return c}});var i=r(48646),a=r(3698),n=r(80158),o=r(25082),s=r(38478),d=r(56388);function u(){let e=(0,i._)(["","->>'sessionId' = ",""]);return u=function(){return e},e}async function l(e){return await a.db.insert(n.users).values(e).returning()}async function c(e){let{userId:t,type:r,name:i,description:o,duration:s,moodScore:d,moodNote:u}=e;try{return await a.db.insert(n.activities).values({userId:t,type:r,name:i,description:o,duration:s,moodScore:d,moodNote:u,timestamp:new Date,completed:!1,createdAt:new Date,updatedAt:new Date})}catch(e){throw console.error("Error creating activity:",e),e}}async function f(e){try{console.log("Getting sessions for userId:",e);let t=await a.db.select({id:n.therapySessions.id,userId:n.therapySessions.userId,type:n.therapySessions.type,status:n.therapySessions.status,scheduledTime:n.therapySessions.scheduledTime,summary:n.therapySessions.summary}).from(n.therapySessions).where((0,o.eq)(n.therapySessions.userId,e)).orderBy((0,s.C)(n.therapySessions.scheduledTime));return console.log("Found sessions:",t),t}catch(e){throw console.error("Error getting therapy sessions:",e),e}}async function m(e){let{userId:t,type:r}=e;try{return await a.db.insert(n.therapySessions).values({userId:t,type:r,status:"in_progress",scheduledTime:new Date,title:"New Session - ".concat(new Date().toLocaleString())}).returning()}catch(e){throw console.error("Failed to create therapy session:",e),e}}async function p(e){try{return await a.db.select().from(n.chatHistory).where((0,d.i6)(u(),n.chatHistory.context,e)).orderBy(n.chatHistory.timestamp)}catch(e){throw console.error("Error getting session chat history:",e),e}}async function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7;try{let r=new Date;return r.setDate(r.getDate()-t),await a.db.select().from(n.activities).where((0,o.xD)((0,o.eq)(n.activities.userId,e),(0,o.eg)(n.activities.timestamp,r))).orderBy((0,s.C)(n.activities.timestamp))}catch(e){throw console.error("Error getting user activities:",e),e}}async function w(e){let{userId:t,mood:r,note:i}=e;return await a.db.insert(n.activities).values({userId:t,type:"mood",name:"Mood Entry",description:i,moodScore:r,moodNote:i,timestamp:new Date,completed:!0,createdAt:new Date,updatedAt:new Date})}async function L(e){}async function _(e){try{let t=await a.db.select({id:n.wearableDevices.id,deviceType:n.wearableDevices.deviceType,deviceId:n.wearableDevices.deviceId,lastSynced:n.wearableDevices.lastSynced,settings:n.wearableDevices.settings}).from(n.wearableDevices).where((0,o.eq)(n.wearableDevices.userId,e));return await Promise.all(t.map(async e=>{var t;let r=await a.db.select().from(n.wearableMetrics).where((0,o.eq)(n.wearableMetrics.deviceId,e.id)).orderBy((0,s.C)(n.wearableMetrics.timestamp)).limit(1);return{...e,metrics:(null===(t=r[0])||void 0===t?void 0:t.value)||null,status:e.lastSynced&&new Date().getTime()-new Date(e.lastSynced).getTime()<864e5?"connected":"disconnected"}}))}catch(e){throw console.error("Error getting connected devices:",e),e}}},3698:function(e,t,r){r.d(t,{db:function(){return s}});var i=r(23302),a=r(5504),n=r(80158);let o=(0,i.qn)("postgresql://neondb_owner:npg_8mPw6WMyXtCE@ep-bitter-recipe-a85tzvx5-pooler.eastus2.azure.neon.tech/neondb?sslmode=require"),s=(0,a.tS)(o,{schema:n})},80158:function(e,t,r){r.r(t),r.d(t,{activities:function(){return _},activityProgress:function(){return h},chatHistory:function(){return y},chatMessages:function(){return S},chatRoomMembers:function(){return D},chatRooms:function(){return I},commentLikes:function(){return b},comments:function(){return A},deviceSettings:function(){return f},forumMembers:function(){return g},forums:function(){return v},healthMetrics:function(){return m},postLikes:function(){return B},posts:function(){return N},therapySessions:function(){return c},userPreferences:function(){return p},users:function(){return l},wearableDevices:function(){return w},wearableMetrics:function(){return L}});var i=r(91813),a=r(1333),n=r(82052),o=r(50177),s=r(94651),d=r(76016),u=r(80894);let l=(0,i.af)("users",{id:(0,a.fL)("id").primaryKey(),name:(0,a.fL)("name"),email:(0,a.fL)("email"),walletId:(0,a.fL)("wallet_id").notNull().unique(),walletAddress:(0,a.fL)("wallet_address"),encryptedData:(0,n.JB)("encrypted_data"),createdAt:(0,o.AB)("created_at").notNull().defaultNow(),updatedAt:(0,o.AB)("updated_at").notNull().defaultNow()}),c=(0,i.af)("therapy_sessions",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id),scheduledTime:(0,o.AB)("scheduled_time").notNull(),status:(0,a.fL)("status").notNull(),type:(0,a.fL)("type").notNull(),notes:(0,a.fL)("notes"),summary:(0,a.fL)("summary"),aiRecommendations:(0,n.JB)("ai_recommendations"),mood:(0,a.fL)("mood"),createdAt:(0,o.AB)("created_at").defaultNow(),completedAt:(0,o.AB)("completed_at"),title:(0,a.fL)("title"),updatedAt:(0,o.AB)("updated_at").notNull().defaultNow()}),f=(0,i.af)("device_settings",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id),deviceType:(0,a.fL)("device_type").notNull(),settings:(0,n.JB)("settings").notNull(),updatedAt:(0,o.AB)("updated_at").defaultNow()}),m=(0,i.af)("health_metrics",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id),metricType:(0,a.fL)("metric_type").notNull(),value:(0,n.JB)("value").notNull(),timestamp:(0,o.AB)("timestamp").defaultNow()}),p=(0,i.af)("user_preferences",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id).unique(),notifications:(0,d.O7)("notifications").default(!0),aiInterventions:(0,d.O7)("ai_interventions").default(!0),preferences:(0,n.JB)("preferences").default({}),updatedAt:(0,o.AB)("updated_at").defaultNow()}),y=(0,i.af)("chat_history",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id),message:(0,a.fL)("message").notNull(),role:(0,a.fL)("role").notNull(),timestamp:(0,o.AB)("timestamp").defaultNow(),sentiment:(0,a.fL)("sentiment"),context:(0,n.JB)("context")}),w=(0,i.af)("wearable_devices",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id),deviceType:(0,a.fL)("device_type").notNull(),deviceId:(0,a.fL)("device_id").notNull(),accessToken:(0,a.fL)("access_token"),refreshToken:(0,a.fL)("refresh_token"),lastSynced:(0,o.AB)("last_synced"),settings:(0,n.JB)("settings")}),L=(0,i.af)("wearable_metrics",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id),deviceId:(0,s.Vj)("device_id").references(()=>w.id),metricType:(0,a.fL)("metric_type").notNull(),value:(0,n.JB)("value").notNull(),timestamp:(0,o.AB)("timestamp").defaultNow(),source:(0,a.fL)("source").notNull()}),_=(0,i.af)("activities",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),userId:(0,a.fL)("user_id").references(()=>l.id),type:(0,a.fL)("type").notNull(),name:(0,a.fL)("name").notNull(),description:(0,a.fL)("description"),timestamp:(0,o.AB)("timestamp").notNull().defaultNow(),duration:(0,u._L)("duration"),completed:(0,d.O7)("completed").notNull().default(!1),moodScore:(0,u._L)("mood_score"),moodNote:(0,a.fL)("mood_note"),createdAt:(0,o.AB)("created_at").notNull().defaultNow(),updatedAt:(0,o.AB)("updated_at").notNull().defaultNow()}),h=(0,i.af)("activity_progress",{id:(0,s.Vj)("id").primaryKey().defaultRandom(),activityId:(0,s.Vj)("activity_id").references(()=>_.id),userId:(0,a.fL)("user_id").references(()=>l.id),status:(0,a.fL)("status").notNull(),startedAt:(0,o.AB)("started_at").notNull(),completedAt:(0,o.AB)("completed_at"),notes:(0,a.fL)("notes"),metrics:(0,n.JB)("metrics")}),v=(0,i.af)("forums",{id:(0,a.fL)("id").primaryKey(),name:(0,a.fL)("name").notNull(),description:(0,a.fL)("description").notNull(),icon:(0,a.fL)("icon").notNull(),memberCount:(0,u._L)("member_count").default(0),postCount:(0,u._L)("post_count").default(0),isPrivate:(0,d.O7)("is_private").default(!1),topics:(0,a.fL)("topics").array().notNull(),createdAt:(0,o.AB)("created_at").defaultNow(),updatedAt:(0,o.AB)("updated_at").defaultNow()}),N=(0,i.af)("posts",{id:(0,a.fL)("id").primaryKey(),forumId:(0,a.fL)("forum_id").references(()=>v.id).notNull(),userId:(0,a.fL)("user_id").notNull(),title:(0,a.fL)("title").notNull(),content:(0,a.fL)("content").notNull(),topic:(0,a.fL)("topic").notNull(),likes:(0,u._L)("likes").default(0),comments:(0,u._L)("comments").default(0),tags:(0,a.fL)("tags").array(),isPrivate:(0,d.O7)("is_private").default(!1),createdAt:(0,o.AB)("created_at").defaultNow(),updatedAt:(0,o.AB)("updated_at").defaultNow()}),A=(0,i.af)("comments",{id:(0,a.fL)("id").primaryKey(),postId:(0,a.fL)("post_id").references(()=>N.id).notNull(),userId:(0,a.fL)("user_id").notNull(),content:(0,a.fL)("content").notNull(),likes:(0,u._L)("likes").default(0),createdAt:(0,o.AB)("created_at").defaultNow(),updatedAt:(0,o.AB)("updated_at").defaultNow()}),g=(0,i.af)("forum_members",{id:(0,a.fL)("id").primaryKey(),forumId:(0,a.fL)("forum_id").references(()=>v.id).notNull(),userId:(0,a.fL)("user_id").notNull(),role:(0,a.fL)("role").default("member"),joinedAt:(0,o.AB)("joined_at").defaultNow()}),B=(0,i.af)("post_likes",{id:(0,a.fL)("id").primaryKey(),postId:(0,a.fL)("post_id").references(()=>N.id).notNull(),userId:(0,a.fL)("user_id").notNull(),createdAt:(0,o.AB)("created_at").defaultNow()}),b=(0,i.af)("comment_likes",{id:(0,a.fL)("id").primaryKey(),commentId:(0,a.fL)("comment_id").references(()=>A.id).notNull(),userId:(0,a.fL)("user_id").notNull(),createdAt:(0,o.AB)("created_at").defaultNow()}),I=(0,i.af)("chat_rooms",{id:(0,a.fL)("id").primaryKey(),name:(0,a.fL)("name").notNull(),description:(0,a.fL)("description").notNull(),icon:(0,a.fL)("icon").notNull(),memberCount:(0,u._L)("member_count").default(0),isPrivate:(0,d.O7)("is_private").default(!1),createdAt:(0,o.AB)("created_at").defaultNow(),updatedAt:(0,o.AB)("updated_at").defaultNow()}),S=(0,i.af)("chat_messages",{id:(0,a.fL)("id").primaryKey(),roomId:(0,a.fL)("room_id").references(()=>I.id).notNull(),userId:(0,a.fL)("user_id").notNull(),content:(0,a.fL)("content").notNull(),createdAt:(0,o.AB)("created_at").defaultNow(),updatedAt:(0,o.AB)("updated_at").defaultNow()}),D=(0,i.af)("chat_room_members",{id:(0,a.fL)("id").primaryKey(),roomId:(0,a.fL)("room_id").references(()=>I.id).notNull(),userId:(0,a.fL)("user_id").notNull(),role:(0,a.fL)("role").default("member"),joinedAt:(0,o.AB)("joined_at").defaultNow(),lastSeen:(0,o.AB)("last_seen").defaultNow()})}}]);